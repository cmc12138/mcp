# 使用示例文档

## 1. 概述

本文档提供了前端逻辑转AI理解MCP项目的详细使用示例，包括安装、配置、基本使用和高级用法。

## 2. 安装和配置

### 2.1 环境要求

- Node.js >= 18.0.0
- npm >= 8.0.0
- TypeScript >= 5.2.0

### 2.2 安装依赖

```bash
# 克隆项目
git clone https://github.com/your-username/frontend-analysis-mcp.git
cd frontend-analysis-mcp

# 安装依赖
npm install

# 构建项目
npm run build
```

### 2.3 配置MCP客户端

#### 2.3.1 Claude Desktop配置

在Claude Desktop的配置文件中添加MCP服务器：

```json
{
  "mcpServers": {
    "frontend-analysis": {
      "command": "node",
      "args": ["dist/mcp-server-example.js"],
      "env": {
        "NODE_ENV": "production"
      }
    }
  }
}
```

#### 2.3.2 其他MCP客户端配置

```json
{
  "servers": [
    {
      "name": "frontend-analysis-mcp",
      "command": "node",
      "args": ["dist/mcp-server-example.js"],
      "cwd": "/path/to/frontend-analysis-mcp"
    }
  ]
}
```

## 3. 基本使用示例

### 3.1 启动服务器

```bash
# 开发模式启动
npm run dev

# 生产模式启动
npm start
```

### 3.2 分析React项目

```typescript
// 示例React项目结构
my-react-app/
├── src/
│   ├── components/
│   │   ├── Header.jsx
│   │   └── Footer.jsx
│   ├── pages/
│   │   └── Home.jsx
│   ├── utils/
│   │   └── helpers.js
│   └── App.jsx
├── package.json
└── README.md
```

**MCP工具调用**:
```json
{
  "name": "analyze_project",
  "arguments": {
    "projectPath": "/path/to/my-react-app",
    "framework": "react"
  }
}
```

**预期响应**:
```json
{
  "content": [
    {
      "type": "text",
      "text": "{\n  \"name\": \"my-react-app\",\n  \"framework\": \"react\",\n  \"files\": [\n    {\n      \"path\": \"/path/to/my-react-app/src/App.jsx\",\n      \"type\": \"component\",\n      \"variables\": [...],\n      \"functions\": [...],\n      \"components\": [...]\n    }\n  ],\n  \"dependencies\": [...]\n}"
    }
  ]
}
```

### 3.3 分析Vue项目

```typescript
// 示例Vue项目结构
my-vue-app/
├── src/
│   ├── components/
│   │   ├── Header.vue
│   │   └── Footer.vue
│   ├── views/
│   │   └── Home.vue
│   ├── utils/
│   │   └── helpers.js
│   └── App.vue
├── package.json
└── README.md
```

**MCP工具调用**:
```json
{
  "name": "analyze_project",
  "arguments": {
    "projectPath": "/path/to/my-vue-app",
    "framework": "vue"
  }
}
```

## 4. 详细使用示例

### 4.1 变量分析示例

**源代码** (`src/utils/helpers.js`):
```javascript
const API_BASE_URL = 'https://api.example.com';
let userToken = null;

export function setUserToken(token) {
  userToken = token;
}

export function getApiUrl(endpoint) {
  return `${API_BASE_URL}${endpoint}`;
}

export const config = {
  timeout: 5000,
  retries: 3
};
```

**MCP工具调用**:
```json
{
  "name": "get_variable_info",
  "arguments": {
    "variableName": "API_BASE_URL",
    "filePath": "/path/to/src/utils/helpers.js"
  }
}
```

**预期响应**:
```json
{
  "content": [
    {
      "type": "text",
      "text": "{\n  \"name\": \"API_BASE_URL\",\n  \"type\": \"string\",\n  \"scope\": \"module\",\n  \"declarationType\": \"const\",\n  \"usage\": [\n    {\n      \"type\": \"reference\",\n      \"location\": {\n        \"line\": 7,\n        \"column\": 20,\n        \"file\": \"/path/to/src/utils/helpers.js\"\n      },\n      \"context\": \"return `${API_BASE_URL}${endpoint}`;\"\n    }\n  ],\n  \"dependencies\": [],\n  \"isExported\": false,\n  \"isImported\": false,\n  \"line\": 1,\n  \"column\": 6\n}"
    }
  ]
}
```

### 4.2 函数分析示例

**源代码** (`src/components/UserProfile.jsx`):
```jsx
import React, { useState, useEffect } from 'react';

function UserProfile({ userId, onUpdate }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchUser(userId).then(userData => {
      setUser(userData);
      setLoading(false);
    });
  }, [userId]);

  const handleUpdate = (newData) => {
    setUser(prev => ({ ...prev, ...newData }));
    onUpdate?.(newData);
  };

  if (loading) return <div>Loading...</div>;

  return (
    <div>
      <h1>{user?.name}</h1>
      <button onClick={() => handleUpdate({ name: 'New Name' })}>
        Update Name
      </button>
    </div>
  );
}

export default UserProfile;
```

**MCP工具调用**:
```json
{
  "name": "get_variable_info",
  "arguments": {
    "variableName": "UserProfile",
    "filePath": "/path/to/src/components/UserProfile.jsx"
  }
}
```

**预期响应**:
```json
{
  "content": [
    {
      "type": "text",
      "text": "{\n  \"name\": \"UserProfile\",\n  \"type\": \"function\",\n  \"scope\": \"module\",\n  \"declarationType\": \"function\",\n  \"usage\": [],\n  \"dependencies\": [\"React\", \"useState\", \"useEffect\", \"fetchUser\"],\n  \"isExported\": true,\n  \"isImported\": false,\n  \"line\": 3,\n  \"column\": 0\n}"
    }
  ]
}
```

### 4.3 组件分析示例

**MCP资源访问**:
```json
{
  "uri": "project://components"
}
```

**预期响应**:
```json
{
  "contents": [
    {
      "uri": "project://components",
      "mimeType": "application/json",
      "text": "[\n  {\n    \"name\": \"UserProfile\",\n    \"type\": \"functional\",\n    \"props\": [\n      {\n        \"name\": \"userId\",\n        \"type\": \"any\",\n        \"required\": true,\n        \"description\": \"\"\n      },\n      {\n        \"name\": \"onUpdate\",\n        \"type\": \"any\",\n        \"required\": false,\n        \"description\": \"\"\n      }\n    ],\n    \"state\": [\n      {\n        \"name\": \"user\",\n        \"type\": \"any\",\n        \"initialValue\": null\n      },\n      {\n        \"name\": \"loading\",\n        \"type\": \"any\",\n        \"initialValue\": true\n      }\n    ],\n    \"hooks\": [\n      {\n        \"name\": \"useState\",\n        \"type\": \"hook\",\n        \"dependencies\": [],\n        \"line\": 4,\n        \"column\": 2\n      },\n      {\n        \"name\": \"useEffect\",\n        \"type\": \"hook\",\n        \"dependencies\": [\"userId\"],\n        \"line\": 7,\n        \"column\": 2\n      }\n    ],\n    \"line\": 3,\n    \"column\": 0,\n    \"file\": \"/path/to/src/components/UserProfile.jsx\"\n  }\n]"
    }
  ]
}
```

### 4.4 流程图生成示例

**MCP工具调用**:
```json
{
  "name": "generate_flow_diagram",
  "arguments": {
    "filePath": "/path/to/src/components/UserProfile.jsx",
    "diagramType": "control_flow"
  }
}
```

**预期响应**:
```json
{
  "content": [
    {
      "type": "text",
      "text": "# control_flow 图表\n\n文件: /path/to/src/components/UserProfile.jsx\n\n```mermaid\ngraph TD\n    A[开始] --> B[初始化状态]\n    B --> C[useEffect执行]\n    C --> D[fetchUser调用]\n    D --> E[更新user状态]\n    E --> F[设置loading为false]\n    F --> G[渲染组件]\n    G --> H[用户交互]\n    H --> I[handleUpdate调用]\n    I --> J[更新user状态]\n    J --> K[调用onUpdate]\n    K --> G\n```"
    }
  ]
}
```

## 5. 高级使用示例

### 5.1 批量分析多个项目

```typescript
// 批量分析脚本
const projects = [
  { path: '/path/to/project1', framework: 'react' },
  { path: '/path/to/project2', framework: 'vue' },
  { path: '/path/to/project3', framework: 'angular' }
];

for (const project of projects) {
  // 分析项目
  const analyzeResult = await callTool('analyze_project', {
    projectPath: project.path,
    framework: project.framework
  });
  
  // 获取项目结构
  const structure = await readResource('project://structure');
  
  // 生成报告
  console.log(`项目 ${project.path} 分析完成`);
  console.log(`文件数量: ${JSON.parse(structure.contents[0].text).files.length}`);
}
```

### 5.2 自定义分析流程

```typescript
// 自定义分析流程
async function customAnalysis(projectPath: string) {
  // 1. 分析项目
  await callTool('analyze_project', { projectPath });
  
  // 2. 获取所有变量
  const variables = await readResource('project://variables');
  const variableList = JSON.parse(variables.contents[0].text);
  
  // 3. 分析特定类型的变量
  const stateVariables = variableList.filter(v => 
    v.name.includes('State') || v.name.includes('state')
  );
  
  // 4. 获取组件信息
  const components = await readResource('project://components');
  const componentList = JSON.parse(components.contents[0].text);
  
  // 5. 生成自定义报告
  const report = {
    projectPath,
    totalVariables: variableList.length,
    stateVariables: stateVariables.length,
    totalComponents: componentList.length,
    reactComponents: componentList.filter(c => c.type === 'functional').length
  };
  
  return report;
}
```

### 5.3 集成到CI/CD流程

```yaml
# GitHub Actions示例
name: Code Analysis
on: [push, pull_request]

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm install
        
      - name: Build MCP server
        run: npm run build
        
      - name: Analyze frontend code
        run: |
          node dist/mcp-server-example.js &
          sleep 5
          # 调用MCP工具进行分析
          # 生成分析报告
          
      - name: Upload analysis results
        uses: actions/upload-artifact@v2
        with:
          name: analysis-results
          path: analysis-report.json
```

## 6. 错误处理示例

### 6.1 常见错误处理

```typescript
// 错误处理示例
async function safeAnalyze(projectPath: string) {
  try {
    const result = await callTool('analyze_project', { projectPath });
    return result;
  } catch (error) {
    if (error.message.includes('请先分析项目')) {
      console.error('需要先调用analyze_project工具');
    } else if (error.message.includes('文件未找到')) {
      console.error('文件路径错误:', projectPath);
    } else if (error.message.includes('Failed to parse file')) {
      console.error('文件解析失败，请检查语法');
    } else {
      console.error('未知错误:', error.message);
    }
    throw error;
  }
}
```

### 6.2 重试机制

```typescript
// 重试机制示例
async function analyzeWithRetry(projectPath: string, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await callTool('analyze_project', { projectPath });
    } catch (error) {
      if (i === maxRetries - 1) {
        throw error;
      }
      console.log(`重试 ${i + 1}/${maxRetries}:`, error.message);
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}
```

## 7. 性能优化示例

### 7.1 增量分析

```typescript
// 增量分析示例
class IncrementalAnalyzer {
  private cache = new Map();
  
  async analyzeFile(filePath: string, lastModified: number) {
    const cacheKey = `${filePath}:${lastModified}`;
    
    if (this.cache.has(cacheKey)) {
      return this.cache.get(cacheKey);
    }
    
    const result = await this.performAnalysis(filePath);
    this.cache.set(cacheKey, result);
    
    return result;
  }
}
```

### 7.2 并行处理

```typescript
// 并行处理示例
async function analyzeMultipleFiles(filePaths: string[]) {
  const chunks = chunkArray(filePaths, 5); // 每批处理5个文件
  const results = [];
  
  for (const chunk of chunks) {
    const promises = chunk.map(filePath => 
      callTool('get_variable_info', { 
        variableName: 'main', 
        filePath 
      })
    );
    
    const chunkResults = await Promise.all(promises);
    results.push(...chunkResults);
  }
  
  return results;
}
```

## 8. 调试和监控

### 8.1 调试模式

```bash
# 启用调试模式
DEBUG=frontend-analysis-mcp npm run dev

# 详细日志
NODE_ENV=development npm run dev
```

### 8.2 性能监控

```typescript
// 性能监控示例
class PerformanceMonitor {
  private metrics = new Map();
  
  startTimer(operation: string) {
    this.metrics.set(operation, Date.now());
  }
  
  endTimer(operation: string) {
    const startTime = this.metrics.get(operation);
    if (startTime) {
      const duration = Date.now() - startTime;
      console.log(`${operation} 耗时: ${duration}ms`);
      this.metrics.delete(operation);
    }
  }
}

// 使用示例
const monitor = new PerformanceMonitor();
monitor.startTimer('analyze_project');
const result = await callTool('analyze_project', { projectPath });
monitor.endTimer('analyze_project');
```

## 9. 最佳实践

### 9.1 项目结构建议

```
frontend-analysis-mcp/
├── src/
│   ├── analyzer/
│   │   ├── FrontendCodeAnalyzer.ts
│   │   └── types.ts
│   ├── server/
│   │   └── MCPServer.ts
│   └── utils/
│       └── helpers.ts
├── docs/
│   ├── 01-项目架构文档.md
│   ├── 02-数据结构定义文档.md
│   ├── 03-代码分析器实现文档.md
│   ├── 04-MCP服务器实现文档.md
│   ├── 05-API接口参考文档.md
│   └── 06-使用示例文档.md
├── examples/
│   ├── react-project/
│   ├── vue-project/
│   └── angular-project/
├── tests/
│   ├── unit/
│   └── integration/
└── package.json
```

### 9.2 代码组织建议

```typescript
// 模块化组织
export class FrontendCodeAnalyzer {
  // 公共方法
  async analyzeProject(): Promise<ProjectInfo> { ... }
  
  // 私有方法
  private detectFramework(): void { ... }
  private analyzeFiles(): Promise<void> { ... }
}

export class MCPServer {
  // 公共方法
  async run(): Promise<void> { ... }
  
  // 私有方法
  private setupHandlers(): void { ... }
  private handleAnalyzeProject(args: any): Promise<any> { ... }
}
```

### 9.3 错误处理建议

```typescript
// 统一错误处理
class AnalysisError extends Error {
  constructor(
    message: string,
    public code: string,
    public context?: any
  ) {
    super(message);
    this.name = 'AnalysisError';
  }
}

// 使用示例
try {
  const result = await analyzer.analyzeProject();
} catch (error) {
  if (error instanceof AnalysisError) {
    console.error(`分析错误 [${error.code}]:`, error.message);
  } else {
    console.error('未知错误:', error);
  }
}
```

---

**文档版本**: v1.0  
**创建日期**: 2024年12月  
**最后更新**: 2024年12月  
**维护者**: AI助手
