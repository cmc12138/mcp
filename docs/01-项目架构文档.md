# 前端逻辑转AI理解MCP项目架构文档

## 1. 项目概述

### 1.1 项目目标

本项目旨在开发一个基于MCP（Model Context Protocol）的工具，将前端项目的代码逻辑转换为AI易于理解的流程图和对象结构，精确描述每个变量的用途和作用域。

### 1.2 核心功能

#### ✅ 已完成功能

- 前端代码AST解析和逻辑分析 ✅
- 变量追踪和作用域分析 ✅
- 函数调用关系分析 ✅
- 组件结构分析 ✅
- 生成AI友好的结构化数据 ✅
- 提供标准化的MCP API接口 ✅

#### 🔄 部分完成功能

- 流程图生成 (70% 完成)
- 性能优化 (60% 完成)
- 高级分析功能 (40% 完成)

#### ❌ 待开发功能

- 跨文件变量追踪
- 复杂依赖关系分析
- 代码质量分析
- 交互式可视化

## 2. 整体架构

### 2.1 系统架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端项目代码   │───▶│   AST解析器     │───▶│   逻辑分析器     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   AI模型接口    │◀───│   MCP服务器     │◀───│   数据转换器     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 核心组件层次

#### 2.2.1 数据层 (Data Layer)

- **ProjectInfo**: 项目整体信息
- **FileInfo**: 文件级别信息
- **VariableInfo**: 变量详细信息
- **FunctionInfo**: 函数详细信息
- **ComponentInfo**: 组件详细信息

#### 2.2.2 分析层 (Analysis Layer)

- **FrontendCodeAnalyzer**: 核心代码分析器
- **AST解析器**: 基于Babel的代码解析
- **变量追踪器**: 变量使用情况分析
- **依赖分析器**: 代码依赖关系分析

#### 2.2.3 服务层 (Service Layer)

- **FrontendAnalysisMCPServer**: MCP协议服务器
- **工具处理器**: 处理MCP工具调用
- **资源处理器**: 处理MCP资源访问

#### 2.2.4 接口层 (Interface Layer)

- **MCP工具接口**: 标准化的工具调用接口
- **MCP资源接口**: 标准化的资源访问接口
- **错误处理**: 统一的错误处理机制

## 3. 模块详细设计

### 3.1 FrontendCodeAnalyzer 类

#### 3.1.1 职责

- 项目整体分析协调
- 框架类型检测
- 文件扫描和分析
- 依赖关系分析

#### 3.1.2 核心方法

```typescript
class FrontendCodeAnalyzer {
  // 主要公共方法
  async analyzeProject(): Promise<ProjectInfo>;

  // 私有分析方法
  private detectFramework(): void;
  private async analyzeDependencies(): Promise<void>;
  private async analyzeFiles(): Promise<void>;
  private getSourceFiles(): string[];
  private async analyzeFile(filePath: string): Promise<FileInfo>;
}
```

#### 3.1.3 分析流程

1. **框架检测**: 通过package.json检测项目框架类型
2. **依赖分析**: 分析项目依赖关系
3. **文件扫描**: 递归扫描源代码文件
4. **文件分析**: 对每个文件进行详细分析
5. **结果整合**: 整合所有分析结果

### 3.2 代码分析模块

#### 3.2.1 变量分析 (analyzeVariables)

- **功能**: 分析文件中的所有变量
- **支持类型**: var, let, const, function, class
- **分析内容**: 类型推断、作用域、使用情况、依赖关系

#### 3.2.2 函数分析 (analyzeFunctions)

- **功能**: 分析文件中的所有函数
- **支持类型**: function, arrow, method, constructor
- **分析内容**: 参数、返回值、调用关系、复杂度

#### 3.2.3 组件分析 (analyzeComponents)

- **功能**: 分析React/Vue组件
- **支持类型**: functional, class, sfc
- **分析内容**: props, state, hooks, 生命周期

### 3.3 MCP服务器模块

#### 3.3.1 工具定义

- **analyze_project**: 分析整个项目
- **get_variable_info**: 获取特定变量信息
- **generate_flow_diagram**: 生成流程图

#### 3.3.2 资源定义

- **project://structure**: 项目结构信息
- **project://variables**: 变量信息
- **project://components**: 组件信息

#### 3.3.3 请求处理流程

1. **请求验证**: 验证请求参数
2. **权限检查**: 检查访问权限
3. **业务处理**: 调用相应的分析方法
4. **结果格式化**: 格式化返回结果
5. **错误处理**: 统一错误处理

## 4. 数据流设计

### 4.1 输入数据流

```
前端项目代码 → 文件扫描 → AST解析 → 逻辑分析 → 结构化数据
```

### 4.2 处理数据流

```
原始代码 → Babel AST → 遍历分析 → 提取信息 → 构建对象 → 序列化输出
```

### 4.3 输出数据流

```
结构化数据 → MCP协议 → JSON格式 → AI模型接口
```

## 5. 错误处理策略

### 5.1 错误分类

- **解析错误**: AST解析失败
- **分析错误**: 逻辑分析失败
- **文件错误**: 文件读取失败
- **参数错误**: 输入参数无效

### 5.2 错误处理机制

- **统一错误格式**: 标准化的错误响应格式
- **错误日志**: 详细的错误日志记录
- **优雅降级**: 部分失败时的优雅处理
- **用户友好**: 用户可理解的错误信息

## 6. 性能优化策略

### 6.1 解析优化

- **增量解析**: 只解析变更的文件
- **缓存机制**: 缓存解析结果
- **并行处理**: 多文件并行分析

### 6.2 内存优化

- **流式处理**: 大文件流式处理
- **对象复用**: 复用分析对象
- **及时释放**: 及时释放不需要的对象

### 6.3 网络优化

- **数据压缩**: 压缩传输数据
- **分页加载**: 大数据分页加载
- **缓存策略**: 合理的缓存策略

## 7. 扩展性设计

### 7.1 框架扩展

- **插件机制**: 支持新框架的插件扩展
- **配置驱动**: 通过配置支持新框架
- **接口抽象**: 抽象的分析接口

### 7.2 功能扩展

- **分析器扩展**: 支持新的分析功能
- **输出格式扩展**: 支持新的输出格式
- **工具扩展**: 支持新的MCP工具

### 7.3 性能扩展

- **分布式处理**: 支持分布式分析
- **负载均衡**: 支持负载均衡
- **水平扩展**: 支持水平扩展

## 8. 安全考虑

### 8.1 输入安全

- **路径验证**: 验证文件路径安全性
- **内容过滤**: 过滤危险内容
- **大小限制**: 限制文件大小

### 8.2 输出安全

- **数据脱敏**: 敏感数据脱敏
- **访问控制**: 控制数据访问权限
- **审计日志**: 记录访问日志

## 9. 部署架构

### 9.1 单机部署

- **直接运行**: 直接运行Node.js进程
- **Docker部署**: 使用Docker容器部署
- **系统服务**: 作为系统服务运行

### 9.2 分布式部署

- **微服务架构**: 拆分为多个微服务
- **API网关**: 使用API网关统一入口
- **服务发现**: 支持服务发现机制

## 10. 监控和运维

### 10.1 监控指标

- **性能指标**: 响应时间、吞吐量
- **错误指标**: 错误率、错误类型
- **资源指标**: CPU、内存、磁盘使用率

### 10.2 日志管理

- **结构化日志**: 使用结构化日志格式
- **日志聚合**: 集中化日志管理
- **日志分析**: 日志分析和告警

### 10.3 运维工具

- **健康检查**: 服务健康状态检查
- **配置管理**: 动态配置管理
- **版本管理**: 版本发布管理

---

**文档版本**: v1.0  
**创建日期**: 2024年12月  
**最后更新**: 2024年12月  
**维护者**: AI助手
