---
globs: src/analyzer/*.ts
description: ASTåˆ†æå’Œç»„ä»¶æ£€æµ‹çš„æœ€ä½³å®è·µæ¨¡å¼?---

# åˆ†æå™¨æ¨¡å¼è§„åˆ?
## ASTåˆ†ææœ€ä½³å®è·?
### Babel ASTéå†æ¨¡å¼

- ä½¿ç”¨åŠ¨æ€å¯¼å…¥é¿å…å¾ªç¯ä¾èµ–ï¼š`const { default: traverse } = await import('@babel/traverse')`
- å®ç°traverseåŒ…è£…å™¨å‡½æ•°å¤„ç†å¼‚æ­¥æ“ä½?- ä½¿ç”¨è®¿é—®è€…æ¨¡å¼å¤„ç†ä¸åŒç±»å‹çš„ASTèŠ‚ç‚¹

```typescript
// æ¨èçš„ASTéå†æ¨¡å¼
async function traverseAST(ast: any, visitors: any) {
  const { default: traverse } = await import('@babel/traverse');
  return traverse(ast, visitors);
}
```

### ç»„ä»¶æ£€æµ‹è§„åˆ?
- å‡½æ•°ç»„ä»¶ï¼šæ£€æŸ¥å‡½æ•°åæ˜¯å¦ä»¥å¤§å†™å­—æ¯å¼€å¤´æˆ–è¿”å›JSX
- ç±»ç»„ä»¶ï¼šæ£€æŸ¥æ˜¯å¦ç»§æ‰¿è‡ªReact.Component
- ç®­å¤´å‡½æ•°ç»„ä»¶ï¼šæ£€æŸ¥æ˜¯å¦èµ‹å€¼ç»™å¤§å†™å˜é‡å?
```typescript
// ç»„ä»¶æ£€æµ‹ç¤ºä¾?isReactComponent(path: any): boolean {
  // æ£€æŸ¥å‡½æ•°å£°æ˜?  if (t.isFunctionDeclaration(path.node)) {
    return this.isComponentName(path.node.id?.name);
  }

  // æ£€æŸ¥ç®­å¤´å‡½æ•?  if (t.isArrowFunctionExpression(path.node)) {
    return this.isComponentName(path.parent?.id?.name);
  }

  return false;
}
```

## åˆ†æå™¨æ¶æ„æ¨¡å¼?
### åˆ†æå™¨åŸºç±»ç»“æ?
æ‰€æœ‰åˆ†æå™¨éƒ½åº”éµå¾ªä»¥ä¸‹æ¨¡å¼ï¼?
1. æ„é€ å‡½æ•°åˆå§‹åŒ–é…ç½®
2. å…¬å…±åˆ†ææ–¹æ³•å¤„ç†ä¸»è¦é€»è¾‘
3. ç§æœ‰è¾…åŠ©æ–¹æ³•å¤„ç†å…·ä½“å®ç°
4. é”™è¯¯å¤„ç†æ–¹æ³•å¤„ç†å¼‚å¸¸æƒ…å†µ

### æ•°æ®æ”¶é›†æ¨¡å¼

- ä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„å­˜å‚¨åˆ†æç»“æ?- å®ç°å¢é‡åˆ†ææ”¯æŒéƒ¨åˆ†æ›´æ–°
- æä¾›æ•°æ®éªŒè¯å’Œæ¸…ç†æ–¹æ³?
```typescript
// æ•°æ®æ”¶é›†æ¨¡å¼ç¤ºä¾‹
async analyzeComponents(ast: any, filePath: string): Promise<ComponentInfo[]> {
  const components: ComponentInfo[] = [];

  await traverseAST(ast, {
    FunctionDeclaration: async (path: any) => {
      if (this.isReactComponent(path)) {
        const componentInfo = await this.createComponentInfo(path, filePath, 'functional', ast);
        components.push(componentInfo);
      }
    }
  });

  return components;
}
```

## æ€§èƒ½ä¼˜åŒ–æ¨¡å¼

### ç¼“å­˜ç­–ç•¥

- å®ç°ASTè§£æç»“æœç¼“å­˜
- ä½¿ç”¨WeakMapå­˜å‚¨ç»„ä»¶åˆ†æç»“æœ
- é¿å…é‡å¤åˆ†æç›¸åŒçš„ä»£ç ç‰‡æ®?
### å†…å­˜ç®¡ç†

- åŠæ—¶é‡Šæ”¾å¤§å‹ASTå¯¹è±¡å¼•ç”¨
- ä½¿ç”¨æµå¼å¤„ç†å¤„ç†å¤§å‹æ–‡ä»¶
- å®ç°åˆ†æç»“æœçš„åˆ†é¡µåŠ è½?
### å¹¶å‘æ§åˆ¶

- ä½¿ç”¨Promise.allå¹¶è¡Œå¤„ç†ç‹¬ç«‹æ–‡ä»¶
- å®ç°åˆ†æä»»åŠ¡é˜Ÿåˆ—é¿å…èµ„æºäº‰ç”¨
- è®¾ç½®åˆç†çš„å¹¶å‘é™åˆ?
## é”™è¯¯å¤„ç†æ¨¡å¼

### åˆ†æé”™è¯¯åˆ†ç±»

- è§£æé”™è¯¯ï¼šASTè§£æå¤±è´¥
- åˆ†æé”™è¯¯ï¼šç»„ä»¶æ£€æµ‹å¤±è´?- éªŒè¯é”™è¯¯ï¼šæ•°æ®éªŒè¯å¤±è´?- ç³»ç»Ÿé”™è¯¯ï¼šå†…å­˜ä¸è¶³ç­‰

### é”™è¯¯æ¢å¤ç­–ç•¥

- è·³è¿‡æœ‰é—®é¢˜çš„æ–‡ä»¶ç»§ç»­åˆ†æå…¶ä»–æ–‡ä»¶
- æä¾›éƒ¨åˆ†åˆ†æç»“æœè€Œéå®Œå…¨å¤±è´¥
- è®°å½•é”™è¯¯ä¿¡æ¯ç”¨äºåç»­è°ƒè¯•

```typescript
// é”™è¯¯å¤„ç†æ¨¡å¼
try {
  const result = await this.analyzeComponent(path);
  return result;
} catch (error) {
  if (isRecoverableError(error)) {
    console.warn(`Skipping component analysis: ${error.message}`);
    return null;
  }
  throw createAnalysisError('Component analysis failed', error);
}
```

## æ‰©å±•æ€§æ¨¡å¼?
### æ’ä»¶æ¶æ„

- æ”¯æŒè‡ªå®šä¹‰åˆ†æå™¨æ’ä»¶
- æä¾›åˆ†æå™¨æ³¨å†Œå’Œå‘ç°æœºåˆ¶
- å®ç°åˆ†æå™¨é“¾å¼è°ƒç”?
### é…ç½®é©±åŠ¨

- ä½¿ç”¨é…ç½®æ–‡ä»¶æ§åˆ¶åˆ†æè¡Œä¸º
- æ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–?- æä¾›é…ç½®éªŒè¯å’Œé»˜è®¤å€?
### ç»“æœæ ‡å‡†åŒ?
- å®šä¹‰ç»Ÿä¸€çš„åˆ†æç»“æœæ ¼å¼?- å®ç°ç»“æœåºåˆ—åŒ–å’Œååºåˆ—åŒ–
- æä¾›ç»“æœæ¯”è¾ƒå’Œå·®å¼‚æ£€æµ?
