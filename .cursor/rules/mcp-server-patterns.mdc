---
globs: src/server/*.ts
description: MCPæœåŠ¡å™¨å®ç°æ¨¡å¼å’Œæœ€ä½³å®è·?---

# MCPæœåŠ¡å™¨æ¨¡å¼è§„åˆ?
## MCPåè®®å®ç°è§„èŒƒ

### æœåŠ¡å™¨åˆå§‹åŒ–æ¨¡å¼

- å®ç°æ ‡å‡†çš„MCPæœåŠ¡å™¨ç”Ÿå‘½å‘¨æœ?- æ³¨å†Œå·¥å…·å’Œèµ„æºå¤„ç†å™¨
- å¤„ç†è¿æ¥å’Œè®¤è¯é€»è¾‘

```typescript
export class FrontendAnalysisMCPServer {
  private server: Server;
  private analyzer: FrontendCodeAnalyzer;

  async initialize() {
    this.server = new Server({
      name: 'frontend-analysis-mcp',
      version: '1.0.0',
    });

    await this.setupToolHandlers();
    await this.setupResourceHandlers();
  }
}
```

### å·¥å…·å¤„ç†å™¨æ¨¡å¼?
- å®ç°ç»Ÿä¸€çš„å·¥å…·è¯·æ±‚å¤„ç†æ¥å?- æä¾›å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç?- æ”¯æŒå¼‚æ­¥å·¥å…·æ‰§è¡Œ

```typescript
// å·¥å…·å¤„ç†å™¨ç¤ºä¾?async handleTool(name: string, arguments: any): Promise<any> {
  switch (name) {
    case 'analyze_project':
      return await this.analyzeProject(arguments.projectPath);
    case 'analyze_file':
      return await this.analyzeFile(arguments.filePath);
    default:
      throw new Error(`Unknown tool: ${name}`);
  }
}
```

## å·¥å…·å®šä¹‰è§„èŒƒ

### å·¥å…·å…ƒæ•°æ?
- æä¾›å®Œæ•´çš„å·¥å…·æè¿°å’Œå‚æ•°è¯´æ˜
- å®šä¹‰è¾“å…¥è¾“å‡ºç±»å‹å’ŒéªŒè¯è§„åˆ?- æ”¯æŒå·¥å…·ç‰ˆæœ¬ç®¡ç†

```typescript
const tools = [
  {
    name: 'analyze_project',
    description: 'åˆ†æå‰ç«¯é¡¹ç›®çš„ç»„ä»¶ã€å‡½æ•°å’Œä¾èµ–å…³ç³»',
    inputSchema: {
      type: 'object',
      properties: {
        projectPath: {
          type: 'string',
          description: 'é¡¹ç›®æ ¹ç›®å½•è·¯å¾?,
        },
        options: {
          type: 'object',
          properties: {
            includePatterns: { type: 'array', items: { type: 'string' } },
            excludePatterns: { type: 'array', items: { type: 'string' } },
          },
        },
      },
      required: ['projectPath'],
    },
  },
];
```

### å·¥å…·å®ç°æ¨¡å¼

- ä½¿ç”¨åˆ†æå™¨è¿›è¡Œå®é™…å·¥ä½?- å®ç°è¿›åº¦æŠ¥å‘Šå’Œå–æ¶ˆæœºåˆ?- æä¾›è¯¦ç»†çš„ç»“æœæ ¼å¼?
## èµ„æºå¤„ç†å™¨æ¨¡å¼?
### èµ„æºå®šä¹‰

- å®šä¹‰å¯è®¿é—®çš„èµ„æºç±»å‹
- å®ç°èµ„æºåˆ—è¡¨å’Œå†…å®¹è·å?- æ”¯æŒèµ„æºè®¢é˜…å’Œæ›´æ–°é€šçŸ¥

```typescript
const resources = [
  {
    uri: 'file://project/components',
    name: 'é¡¹ç›®ç»„ä»¶åˆ—è¡¨',
    description: 'é¡¹ç›®ä¸­æ‰€æœ‰æ£€æµ‹åˆ°çš„ç»„ä»?,
    mimeType: 'application/json',
  },
];
```

### èµ„æºè®¿é—®æ§åˆ¶

- å®ç°åŸºäºè·¯å¾„çš„èµ„æºè®¿é—®æ§åˆ?- æä¾›èµ„æºç¼“å­˜å’Œè¿‡æœŸæœºåˆ?- æ”¯æŒèµ„æºå†…å®¹è¿‡æ»¤å’Œè½¬æ?
## é”™è¯¯å¤„ç†æ¨¡å¼

### MCPé”™è¯¯å“åº”

- ä½¿ç”¨æ ‡å‡†MCPé”™è¯¯æ ¼å¼
- æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯
- åŒºåˆ†å®¢æˆ·ç«¯é”™è¯¯å’ŒæœåŠ¡å™¨é”™è¯?
```typescript
// é”™è¯¯å¤„ç†ç¤ºä¾‹
try {
  const result = await this.analyzeProject(projectPath);
  return { success: true, data: result };
} catch (error) {
  return {
    success: false,
    error: {
      code: 'ANALYSIS_FAILED',
      message: error.message,
      details: error.stack,
    },
  };
}
```

### é”™è¯¯åˆ†ç±»å’Œæ¢å¤?
- åŒºåˆ†å¯æ¢å¤å’Œä¸å¯æ¢å¤é”™è¯¯
- å®ç°é”™è¯¯é‡è¯•æœºåˆ¶
- æä¾›é™çº§æœåŠ¡æ¨¡å¼

## æ€§èƒ½ä¼˜åŒ–æ¨¡å¼

### å¼‚æ­¥å¤„ç†

- ä½¿ç”¨å¼‚æ­¥é˜Ÿåˆ—å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
- å®ç°ä»»åŠ¡è¿›åº¦æŠ¥å‘Š
- æ”¯æŒä»»åŠ¡å–æ¶ˆå’Œæš‚å?
```typescript
// å¼‚æ­¥ä»»åŠ¡å¤„ç†
async analyzeProjectAsync(projectPath: string): Promise<string> {
  const taskId = generateTaskId();

  // å¯åŠ¨åå°ä»»åŠ¡
  this.runAnalysisTask(taskId, projectPath);

  return taskId;
}

private async runAnalysisTask(taskId: string, projectPath: string) {
  try {
    const result = await this.analyzer.analyzeProject(projectPath);
    this.updateTaskStatus(taskId, 'completed', result);
  } catch (error) {
    this.updateTaskStatus(taskId, 'failed', error);
  }
}
```

### ç¼“å­˜ç­–ç•¥

- å®ç°åˆ†æç»“æœç¼“å­˜
- ä½¿ç”¨å¢é‡æ›´æ–°å‡å°‘é‡å¤è®¡ç®—
- æä¾›ç¼“å­˜å¤±æ•ˆå’Œæ¸…ç†æœºåˆ?
### èµ„æºç®¡ç†

- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- å®ç°èµ„æºæ± ç®¡ç?- æä¾›èµ„æºä½¿ç”¨ç»Ÿè®¡

## å®‰å…¨æ¨¡å¼

### è¾“å…¥éªŒè¯

- éªŒè¯æ‰€æœ‰è¾“å…¥å‚æ•?- é˜²æ­¢è·¯å¾„éå†æ”»å‡»
- é™åˆ¶æ–‡ä»¶è®¿é—®èŒƒå›´

```typescript
// è¾“å…¥éªŒè¯ç¤ºä¾‹
private validateProjectPath(projectPath: string): string {
  const resolvedPath = path.resolve(projectPath);
  const allowedBase = process.cwd();

  if (!resolvedPath.startsWith(allowedBase)) {
    throw new Error('Project path outside allowed directory');
  }

  return resolvedPath;
}
```

### æƒé™æ§åˆ¶

- å®ç°åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ?- é™åˆ¶æ•æ„Ÿæ“ä½œçš„æ‰§è¡?- æä¾›æ“ä½œå®¡è®¡æ—¥å¿—

## ç›‘æ§å’Œæ—¥å¿—æ¨¡å¼?
### æ—¥å¿—è®°å½•

- ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—æ ¼å¼?- è®°å½•å…³é”®æ“ä½œå’Œé”™è¯?- æ”¯æŒä¸åŒæ—¥å¿—çº§åˆ«

```typescript
// æ—¥å¿—è®°å½•ç¤ºä¾‹
this.logger.info('Starting project analysis', {
  projectPath,
  taskId,
  timestamp: new Date().toISOString(),
});
```

### æ€§èƒ½ç›‘æ§

- è®°å½•æ“ä½œæ‰§è¡Œæ—¶é—´
- ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ
- æä¾›æ€§èƒ½æŒ‡æ ‡API

### å¥åº·æ£€æŸ?
- å®ç°æœåŠ¡å™¨å¥åº·çŠ¶æ€æ£€æŸ?- æä¾›ä¾èµ–æœåŠ¡çŠ¶æ€ç›‘æ?- æ”¯æŒä¼˜é›…å…³é—­å’Œé‡å?
